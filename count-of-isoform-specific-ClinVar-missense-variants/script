# Load necessary libraries
library(dplyr)
library(stringr)

# Define the input and output file paths
input_file_regions <- "Homo_sapiens.GRCh38.112.chr_patch_hapl_scaff_isoform_specific_regions.bed"
input_file_variants <- "homo_sapiens_variation_missense_ClinVar_filtered_relevancy.bed"
output_file <- "Homo_sapiens.GRCh38.112.chr_patch_hapl_scaff_isoform_specific_regions_with_variant_counts.bed"

# Read the input files
regions_data <- read.delim(input_file_regions, header = TRUE, sep = "\t")
variants_data <- read.delim(input_file_variants, header = TRUE, sep = "\t")

# Count variants in each region
regions_data <- regions_data %>%
  rowwise() %>%
  mutate(variant_count = sum(variants_data$chr == chr & variants_data$chromStart >= chromStart & variants_data$chromEnd <= chromEnd))

# Write the output to a new BED file
write.table(regions_data, output_file, sep = "\t", quote = FALSE, row.names = FALSE, col.names = TRUE)

cat("Variant counts have been added and data have been written to", output_file, "\n")
